<?php
  $pageData = $this->pageData;
  $actionHeader = $pageData['actionHeader'];
  $teamData = $pageData['teamMembersList'];
  $servicesData = $pageData['outsideServicesList'];
  $materialData = $pageData['materialSuppliesList'];
?>

<script type="text/javascript">

function acknowledgeStart(id){
  $.ajax({
    type: 'get',
    data: 'id=' + id,
    url:'/projects/action/acknowledge-start',
    success: function(successReturn){
      $('#acknowledgeStart-'+id).html(successReturn);
    }
  })
}

function acknowledgeReceipt(id){
  $.ajax({
    type: 'get',
    data: 'id=' + id,
    url:'/projects/action/acknowledge-receipt',
    success: function(successReturn){
      $('#acknowledgeReceipt-'+id).html(successReturn);
    }
  })
}

function acceptReceipt(id){
  $.ajax({
    type: 'get',
    data: 'id=' + id,
    url:'/projects/action/accept-receipt',
    success: function(successReturn){
      $('#receiptAcknowledgement-'+id).html(successReturn);
    }
  })
}

function rejectReceipt(id){
  $.ajax({
    type: 'get',
    data: 'id=' + id,
    url:'/projects/action/reject-receipt',
    success: function(successReturn){
      $('#receiptAcknowledgement-'+id).html(successReturn);
    }
  })
}
</script>

        <div id="MainHeader">
          <h1><?php print($this->translate("#Project")); ?> <a href="/projects/project/detail/?id=<?php print($actionHeader['projectId']) ?>"><?php print($actionHeader['projectTitle']) ?></a></h1>
        </div><!-- MainHeader -->

<?php
    if ($pageData['messageToShow']) {
?>
        <div class="flashMessage">
            <?php echo $this->translate($pageData['messageToShow']); ?>
        </div>
<?php
    }
?>

        <div class="TituloForm">
          <h2><?php print(sprintf($this->translate("#Details of action %s"), $actionHeader['title'])); ?></h2>
                <a href="/projects/action/edit/?id=<?php echo $actionHeader['id'] ?>"><?php echo $this->translate("#Edit action") ?></a>
<?php
    if ($actionHeader['canRemoveAction']) {
?>
                | <a href="/projects/action/remove/?id=<?php echo $actionHeader['id'] ?>"><?php echo $this->translate("#Remove action!") ?></a>
<?php
    }
?>
        </div>

        <div class="Area">

          <div class="three columns alpha Right">
            <?php print($this->translate("#Supervisor:")); ?>
          </div>
          <div class="six columns">
            <?php print($this->translate($actionHeader['supervisorName'])); ?>
          </div>
          <div class="two columns Right">
            <?php print($this->translate("#Status")); ?>
          </div>
          <div class="three columns omega">
            <?php print($this->translate($actionHeader['status'])); ?>
          </div>

          <div class="three columns alpha Right">
            <?php print($this->translate("#Subordinated to:")); ?>
          </div>
          <div class="eleven columns omega">
<?php
$parentId = $actionHeader['parentActionId'];
if ($parentId > 0) {
?>



            <a class="parent_info" href="/projects/action/detail/?id=<?php print($actionHeader['parentActionId']); ?>"><?php print($actionHeader['parentActionTitle']); ?></a>
<?php

} else {

?>
<?php print($this->translate("#None action")); ?>
<?php

}

?>
          </div>

          <div class="three columns alpha Right">
            <?php print($this->translate("#Description:")); ?>
          </div>
          <div class="eleven columns omega">
            <?php print($actionHeader['description']); ?>&nbsp;
          </div>

          <div class="three columns alpha Right">
            <?php print($this->translate("#Predicted begin:")); ?>
          </div>
          <div class="two column">
            <?php print($this->translate($actionHeader['predictedBeginDate'])); ?>
          </div>
          <div class="three columns Right">
            <?php print($this->translate("#Predicted finish:")); ?>
          </div>
          <div class="two columns">
            <?php print($this->translate($actionHeader['predictedFinishDate'])); ?>
          </div>
          <div class="two columns inset-by-two omega">
<?php
            if ($actionHeader['isAMilestone']) {
?>
            <?php print($this->translate('#Is a milestone')); ?>

<?
            } else {
?>
            <?php print($this->translate('#Is not a milestone')); ?>

<?
            }
?>


          </div>

            <div class="three columns alpha Right">
            <?php print($this->translate("#Real begin:")); ?>
          </div>
          <div class="two columns">
            <?php print($this->translate($actionHeader['realBeginDate'])); ?>
          </div>
          <div class="two columns Right">
            <?php print($this->translate("#Real finish:")); ?>
          </div>
          <div class="two columns">
            <?php print($this->translate($actionHeader['realFinishDate'])); ?>
          </div>
          <div class="three columns inset-by-two omega">

<?php
  if ($actionHeader['waitingToReceipt']) {
?>
            <div id="acknowledgeReceipt-<?php print($actionHeader['id']);?>">
              <div class="three columns alpha omega">
                <a class="button full column alpha omega parent_info" href="javascript:acknowledgeReceipt('<?php print($actionHeader['id']); ?>');"><?php print($this->translate("#Confirm task realization")); ?></a>
              </div>
            </div>

&nbsp;

<?php
  } else {
?>
            &nbsp;
<?php
  }
?>
          </div>
<?php
  if ($actionHeader['receiptToAcceptOrReject']) {
?>
          <div class="three columns alpha Right">
            <?php print($this->translate("#Receipt date:")); ?>
          </div>
          <div class="one column">
            <?php print($this->translate($actionHeader['receiptDate'])); ?>
          </div>
          <div class="six columns inset-by-four">
            <div id="receiptAcknowledgement-<?php print($actionHeader['id']);?>">
              <div class="three columns alpha">
                <a class="button full column alpha omega parent_info" href="javascript:rejectReceipt('<?php print($actionHeader['id']); ?>');"><?php print($this->translate("#Reject receipt")); ?></a>
              </div>
              <div class="three columns omega">
                <a class="button full column alpha omega parent_info" href="javascript:acceptReceipt('<?php print($actionHeader['id']); ?>');"><?php print($this->translate("#Accept receipt")); ?></a>
              </div>
            </div>
          </div>
            &nbsp;
<?php
  } else {
?>
          &nbsp;
<?php
  }
?>


<?php
  if (($actionHeader['notAProduct'] ) && ($actionHeader['relatedProductId'])) {
            $productLink = "<a href='/projects/action/detail/?id=" . $actionHeader['relatedProductId'] . "'>" . $actionHeader['relatedProductTitle'] . "</a>";
?>
          <div class="three columns alpha Right">
             &nbsp;
          </div>
          <div class="eight columns omega">
            <?php printf($this->translate("#This action is related to product %s that should be delivered until %s"), $productLink, $this->translate($actionHeader['productDeliveryDate'])); ?>
          </div>

<?php
  }
?>




        </div><!-- .Area -->

        <div id="tabs">
          <ul>
            <li><a href="#tabs-subactions"><?php echo $this->translate("#Subactions") ?></a></li>
            <li><a href="#tabs-team"><?php echo $this->translate("#Team") ?></a></li>
            <li><a href="#tabs-services"><?php echo $this->translate("#Services") ?></a></li>
            <li><a href="#tabs-material"><?php echo $this->translate("#Material") ?></a></li>
          </ul>

          <div id="tabs-subactions">
            <table id="SubAcoes" class="display dataTable">
              <thead>
                <tr>
                  <th width="200"><?php print($this->translate("#Action")); ?></th>
                  <th width="100"><?php print($this->translate("#Supervisor")); ?></th>
                  <th width="100"><?php print($this->translate("#Status")); ?></th>
                  <th width="10">&nbsp;</th>
                </tr>
              </thead>
              <tbody>
<?php
  $subordinatedActions = $actionHeader['subordinatedActions'];
  foreach ($subordinatedActions as $id => $subordinatedActionData) {
?>
                <!-- ### loop de carga das ações subordinadas a esta ação -->
                <tr>
                  <td><a href="/projects/action/detail/?id=<?php print($id);?>"><?php print($subordinatedActionData['title']) ?></a></td>
                  <td><?php print($this->translate($subordinatedActionData['supervisorName'])); ?></td>
                  <td><?php print($this->translate($subordinatedActionData['status'])); ?></td>
                      <td>
                    <a href="#" class="button one column alpha omega anchorclass" rel="submenu1"><?php print($this->translate("#Options")); ?></a>
                    <div id="submenu1" class="anylinkcss">
                        <ul>
                          <li>
                            <a href="/projects/action/edit/?id=<?php print($id);?>"><?php print($this->translate("#Edit")); ?></a>
                          </li>
<?php
    if ($subordinatedActionData['canRemoveAction']) {

?>
                          <li>
                            <a href="/projects/action/remove/?id=<?php print($id);?>"><?php print($this->translate("#Remove")); ?></a>
                          </li>
<?php
    }
?>

                        </ul>
                    </div><!-- #submenu1 -->
                  </td>
                </tr>
              <!-- ### fim do loop de carga das ações subordinadas a esta ação -->
<?php
  }
?>
              </tbody>
            </table>
            <p>
              <a href="/projects/action/create/?subordinatedTo=<?php print($actionHeader['id']) ?>" class="button three columns alpha omega"><?php print($this->translate("#Create new action")) ?></a>
            </p>
          </div><!-- #tabs-subactions -->

          <div id="tabs-team">

          <table id="TeamMembers" class="display dataTable">
            <thead>
              <tr>
                <th width="220"><?php print($this->translate("#Name")); ?></th>
                <th width="80"><?php print($this->translate("#Role")); ?></th>
                <th width="100"><?php print($this->translate("#Value")); ?></th>
                <th width="100"><?php print($this->translate("#Status")); ?></th>
                <th width="100">&nbsp;</th>
              </tr>
            </thead>
            <tbody>

<?php
  foreach ($teamData as $id => $teamMemberData) {
?>          <!-- ### loop de carga dos recursos humanos alocados a esta ação -->
              <tr>
<?php
    if($teamMemberData['contactId']) {
?>
                  <td>
                  <a href="/projects/project/person/?id=<?php print($actionHeader['projectId']) ?>&linkage=<?php print($teamMemberData['linkageId']) ?>"><?php print($teamMemberData['name']) ?></a>
                </td>
<?php
    } else {

?>
                  <td>
                  <?php print($teamMemberData['name']) ?>
                </td>
    <?php

    }


?>
                <td>
                  <?php print($teamMemberData['description']) ?>
                </td>
                <td>
                  <?php print($teamMemberData['value']) ?>
                </td>
                <td>
                  <?php print($teamMemberData['contractingStatusLabel']) ?>
                </td>
                <td>
                  <a href="#" class="button one column alpha omega anchorclass" rel="submenu2"><?php print($this->translate("#Options")); ?></a>
                  <div id="submenu2" class="anylinkcss">
                      <ul>
<?php
    if($teamMemberData['canEditResource']) {

?>
                        <li>
                          <a href="/resources/team-member/edit/?id=<?php print($id) ?>"><?php print($this->translate("#Edit")); ?></a>
                        </li>

<?php
    }
?>
    <?php
    if ($teamMemberData['canContractFlag']) {
?>
                        <li>
                          <a class="parent_info" href="/resources/team-member/contract/?id=<?php print($id);?>" ><?php print($this->translate("#Confirm team member contracting")); ?></a>
                        </li>

<?php
    }
?>
    <?php
    if ($teamMemberData['canDismissFlag']) {
?>
                        <li>
                          <a class="parent_info" href="/resources/team-member/dismiss/?id=<?php print($id);?>" ><?php print($this->translate("#Dismiss team memb")); ?></a>
                        </li>

<?php
    }
?>
<?php

if ($teamMemberData['canProvideOutlay']) {
?>


                          <li>
                            <a href="/finances/outlay/create/?teamMember=<?php echo $id ?>"><?php echo $this->translate("#Provide outlay") ?></a>
                          </li>

<?php
}
?>
<?php

if ($teamMemberData['canRemoveTeamMember']) {
?>


                          <li>
                            <a href="/resources/team-member/remove/?id=<?php echo $id ?>"><?php echo $this->translate("#Remove") ?></a>
                          </li>

<?php
}
?>
<?php
if($teamMemberData['contactId'] > 0) {
?>
                        <li>
                          <a href="/register/contact/detail/?id=<?php print($teamMemberData['contactId']) ?>"><?php echo $this->translate("#Contact detail") ?></a>
                        </li>
<?php
}
?>

                      </ul>
                  </div><!-- #submenu1 -->
                </td>
              </tr>
              <!-- ### fim do loop de carga dos recursos humanos alocados a esta ação -->
<?php
  }
?>

            </tbody>
          </table>

          <p>
            <a href="/resources/team-member/create/?actionId=<?php print($actionHeader['id']); ?>" class="button three columns alpha omega"><?php print($this->translate("#Anticipate team member")); ?></a>
          </p>

          </div><!-- #tabs-team -->


          <div id="tabs-services">

          <table id="OutsideServices" class="display dataTable">
            <thead>
              <tr>
                <th width="220"><?php print($this->translate("#Name")); ?></th>
                <th width="80"><?php print($this->translate("#Service")); ?></th>
                <th width="100"><?php print($this->translate("#Value")); ?></th>
                <th width="100"><?php print($this->translate("#Status")); ?></th>
                <th width="100">&nbsp;</th>
              </tr>
            </thead>
            <tbody>

<?php
  foreach ($servicesData as $id => $outsideServiceData) {
?>          <!-- ### loop de carga dos recursos humanos alocados a esta ação -->
              <tr>
                <td>
                  <a href="/resources/outside-service/edit/?id=<?php print($id) ?>"><?php print($outsideServiceData['name']) ?></a>
                </td>
                <td>
                  <a href="/resources/outside-service/edit/?id=<?php print($id) ?>"><?php print($outsideServiceData['description']) ?></a>
                </td>
                <td>
                  <?php print($outsideServiceData['value']) ?>
                </td>
                <td>
                  <?php print($outsideServiceData['contractingStatusLabel']) ?>
                </td>
                <td>
                  <a href="#" class="button one column alpha omega anchorclass" rel="submenu2"><?php print($this->translate("#Options")); ?></a>
                  <div id="submenu2" class="anylinkcss">
                      <ul>
                        <li>
                          <a href="/resources/outside-service/edit/?id=<?php print($id) ?>"><?php print($this->translate("#Edit")); ?></a>
                        </li>

<?php
    if ($outsideServiceData['canContractFlag']) {
?>
                        <li>
                          <a class="parent_info" href="/resources/outside-service/contract/?id=<?php print($id);?>" ><?php print($this->translate("#Confirm outside service contracting")); ?></a>
                        </li>

<?php
    }
?>
<?php

if ($outsideServiceData['canProvideOutlay']) {
?>


                          <li>
                            <a href="/finances/outlay/create/?outsideService=<?php echo $id ?>"><?php echo $this->translate("#Provide outlay") ?></a>
                          </li>

<?php
}
?>
<?php

if ($outsideServiceData['canRemoveOutsideService']) {
?>


                          <li>
                            <a href="/resources/outside-service/remove/?id=<?php echo $id ?>"><?php echo $this->translate("#Remove") ?></a>
                          </li>

<?php
}
?>
                      </ul>
                  </div><!-- #submenu1 -->
                </td>
              </tr>
              <!-- ### fim do loop de carga dos recursos humanos alocados a esta ação -->
<?php
  }
?>

            </tbody>
          </table>

          <p>
            <a href="/resources/outside-service/create/?actionId=<?php print($actionHeader['id']); ?>" class="button three columns alpha omega"><?php print($this->translate("#Anticipate outside service")); ?></a>
          </p>

          </div><!-- #tabs-services -->

          <div id="tabs-material">

          <table id="MaterialSupplies" class="display dataTable">
            <thead>
              <tr>
                <th width="220"><?php print($this->translate("#Organization")); ?></th>
                <th width="80"><?php print($this->translate("#Service")); ?></th>
                <th width="100"><?php print($this->translate("#Value")); ?></th>
                <th width="100"><?php print($this->translate("#Status")); ?></th>
                <th width="100">&nbsp;</th>
              </tr>
            </thead>
            <tbody>

<?php
  foreach ($materialData as $id => $materialSupplyData) {
?>          <!-- ### loop de carga dos recursos humanos alocados a esta ação -->
              <tr>
                <td>
                  <a href="/resources/material-supply/edit/?id=<?php print($id) ?>"><?php print($materialSupplyData['name']) ?></a>
                </td>
                <td>
                  <a href="/resources/material-supply/edit/?id=<?php print($id) ?>"><?php print($materialSupplyData['description']) ?></a>
                </td>
                <td>
                  <?php print($materialSupplyData['value']) ?>
                </td>
                <td>
                  <?php print($materialSupplyData['contractingStatusLabel']) ?>
                </td>
                <td>
                  <a href="#" class="button one column alpha omega anchorclass" rel="submenu2"><?php print($this->translate("#Options")); ?></a>
                  <div id="submenu2" class="anylinkcss">
                      <ul>
                        <li>
                          <a href="/resources/material-supply/edit/?id=<?php print($id) ?>"><?php print($this->translate("#Edit")); ?></a>
                        </li>

<?php
    if ($materialSupplyData['canContractFlag']) {
?>
                        <li>
                          <a class="parent_info" href="/resources/material-supply/contract/?id=<?php print($id);?>" ><?php print($this->translate("#Confirm material supply contracting")); ?></a>
                        </li>

<?php
    }
?>
<?php

if ($materialSupplyData['canProvideOutlay']) {
?>


                          <li>
                            <a href="/finances/outlay/create/?materialSupply=<?php echo $id ?>"><?php echo $this->translate("#Provide outlay") ?></a>
                          </li>

<?php
}
?>
<?php

if ($materialSupplyData['canRemoveMaterialSupply']) {
?>


                          <li>
                            <a href="/resources/material-supply/remove/?id=<?php echo $id ?>"><?php echo $this->translate("#Remove") ?></a>
                          </li>

<?php
}
?>
                      </ul>
                  </div><!-- #submenu1 -->
                </td>
              </tr>
              <!-- ### fim do loop de carga dos recursos humanos alocados a esta ação -->
<?php
  }
?>

            </tbody>
          </table>

          <p>
            <a href="/resources/material-supply/create/?actionId=<?php print($actionHeader['id']); ?>" class="button three columns alpha omega"><?php print($this->translate("#Anticipate material supply")); ?></a>
          </p>

          </div><!-- #tabs-material -->

        </div><!-- #tabs -->