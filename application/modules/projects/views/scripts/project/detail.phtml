<?php

$pageData = $this->pageData;


        //  projectHeader
        //    id
        //    projectTitle
        //    clientName
        //    areaActivity
        //    ourResponsible
        //    responsibleAtClient
        //    overhead
        //    managementFee
        //    contractValue
        //    contractDate
        //
$projectHeader = $pageData['projectHeader'];

        // receivablesList
        //   * id =>
        //      productTitle
        //      predictedDate
        //      realDate
        //      predictedValue
        //      realValue

$receivablesList = $pageData['receivablesList'];
$productsList = $pageData['productsList'];
$actionsList = $pageData['actionsTree'];
$outlaysList = $pageData['outlaysList'];
$teamData = $pageData['teamMembersList'];
$detailsData = $pageData['detailsData'];
?>
<!--
<script type="text/javascript">
$(document).ready(function(){

	$(".receivable a").hover(function() {
		$(this).next("em").animate({opacity: "show", top: "-75"}, "slow");
	}, function() {
		$(this).next("em").animate({opacity: "hide", top: "-85"}, "fast");
	});


});
</script>

<style type="text/css">
.receivable em {
	width: 180px;
	height: 45px;
	top: -85px;
	left: -15px;
	text-align: center;
	padding: 20px 12px 10px;
	font-style: normal;
	z-index: 2;
	display: none;
}
</style>
-->


    <div id="MainHeader">
      <h1><?php echo $this->translate("#Project") ?> <?php print($projectHeader['projectTitle']) ?></h1>
      <a href="/projects/project/edit/?id=<?php echo $projectHeader['id'] ?>"><?php echo $this->translate("#Edit project") ?></a>
    </div>
    <div class="Area">
      <div class="three columns alpha Right">
        <?php echo $this->translate("#Client:") ?>
      </div>
      <div class="five columns">
        <?php print($projectHeader['clientName']) ?>
      </div>
      <div class="three columns Right">
        <?php echo $this->translate("#Overhead:") ?>
      </div>
      <div class="three columns omega">
        <?php print($projectHeader['overhead']) ?> %
      </div>
      <div class="three columns alpha Right">
        <?php echo $this->translate("#Area activity:") ?>
      </div>
      <div class="five columns">
        <?php print($this->translate($projectHeader['areaActivity'])) ?>
      </div>
      <div class="three columns Right">
        <?php echo $this->translate("#Management fee:") ?>
      </div>
      <div class="three columns omega">
        <?php print($projectHeader['managementFee']) ?> % <!-- ### Talvez seja necessário esconder este campo (re: confusão da Beth sobre o seu uso) -->
      </div>

      <div class="three columns alpha Right">
        <?php echo $this->translate("#Our responsible:") ?>
      </div>
      <div class="five columns">
        <?php print($projectHeader['ourResponsible']) ?>
      </div>
      <div class="three columns Right">
        <?php echo $this->translate("#Contract value:") ?>
      </div>
      <div class="three columns omega">
        <?php print($projectHeader['contractValue']) ?>
      </div>
      <div class="three columns alpha Right">
        <?php echo $this->translate("#Responsible at client:") ?>
      </div>
      <div class="six columns">
        <?php print($projectHeader['responsibleAtClient']) ?>
      </div>
      <div class="two columns Right">
        <?php echo $this->translate("#Contract date:") ?>
      </div>
      <div class="three columns omega">
        <?php print($projectHeader['contractDate']) ?>
      </div>
    </div><!-- .Area -->
    <div id="tabs">
      <ul>
        <li><a href="#tabs-receivables"><?php echo $this->translate("#Receiving") ?></a></li>
        <li><a href="#tabs-products"><?php echo $this->translate("#Products") ?></a></li>
        <li><a href="#tabs-payments"><?php echo $this->translate("#Payments") ?></a></li>
        <li><a href="#tabs-staff"><?php echo $this->translate("#Staff") ?></a></li>
        <li><a href="#tabs-action"><?php echo $this->translate("#Actions") ?></a></li>
        <li><a href="#tabs-details"><?php echo $this->translate("#Details") ?></a></li>
      </ul>

      <div id="tabs-receivables">
        <div class="Area">
           <h2><?php echo $this->translate("#Receiving") ?></h2>
           <table id="Receivings" class="display dataTable">
              <thead>
                <tr>
                  <th width="300"><?php echo $this->translate("#Parcel") ?></th>
                  <th width="50"><?php echo $this->translate("#Predicted date") ?></th>
                  <th width="50"><?php echo $this->translate("#Predicted value") ?></th>
                  <th width="50"><?php echo $this->translate("#Real date") ?></th>
                  <th width="50"><?php echo $this->translate("#Real value") ?></th>
                  <th width="1%">&nbsp;</th>
                </tr>
              </thead>
              <tbody>
                <!-- ### loop de carga das ações que são produto -->
<?php
foreach($receivablesList as $id => $receivableInfo) {
?>
                <tr>
                  <td>
                    <a title="<?php print($receivableInfo['receivableDescription']) ?>" href="/projects/receivable/detail/?id=<?php print($id) ?>"><?php print($receivableInfo['receivableTitle']) ?></a>
                  </td>
                  <td>
                    <?php print($receivableInfo['predictedDate']) ?>
                  </td>
                  <td>
                    <?php print($receivableInfo['predictedValue']) ?>
                  </td>
                  <td class="Right">
                    <?php  print($receivableInfo['realDate']) ?>
                  </td>
                  <td class="Right">
                    <?php  print($receivableInfo['realValue'])  ?>
                  </td>
                  <td>
                    <a href="#" class="anchorclass" rel="submenu1"><?php echo $this->translate("#Options") ?></a>
                    <div id="submenu1" class="anylinkcss">
                        <ul>
                          <li>
                            <!-- [# LINK PARA A EDIÇÃO DO PRODUTO ] -->
                            <a href="/projects/receivable/edit/?id=<?php echo $id ?>"><?php echo $this->translate("#Edit") ?></a>
                          </li>
                          <li>
                            <!-- [# LINK PARA A EDIÇÃO DO PRODUTO ] -->
                            <a href="/projects/action/create/?requirementForReceiving=<?php echo $id ?>"><?php echo $this->translate("#Add product") ?></a>
                          </li>
<?php

if ($receivableInfo['canNotifyReceiving']) {
?>


                          <li>
                            <!-- [# LINK PARA FORM DE CONFIRMAÇÃO DE RECEBIMENTO -> VAI ABRIR EM BOX DE DIÁLOGO MODAL ] -->
                            <a href="/projects/receivable/notify/?id=<?php echo $id ?>"><?php echo $this->translate("#Notify receiving") ?></a>
                          </li>

<?php
}

?>
                            </ul>
                    </div><!-- #submenu1 -->
                  </td>
                </tr>
<?php
}
?>
              </tbody>
            </table><br />

          </div><!-- Area -->
    <div class="Area">

      <p>
        <a href="/projects/receivable/create/?project=<?php echo $projectHeader['id'] ?>" class="button three columns alpha omega"><?php echo $this->translate("#Predict receiving") ?></a>
      </p>

    </div><!-- .Area -->

        </div><!-- tabs-receivables -->

      <div id="tabs-products">
        <div class="Area">
           <h2><?php echo $this->translate("#Product") ?></h2>
           <table id="Products" class="display dataTable">
              <thead>
                <tr>
                  <th width="225"><?php echo $this->translate("#Product") ?></th>
                  <th width="50"><?php echo $this->translate("#Predicted date") ?></th>
                  <th width="50"><?php echo $this->translate("#Real date") ?></th>
                  <th width="70"><?php echo $this->translate("#Status") ?></th>
                  <th width="30"><?php echo $this->translate("#% physical progress")  ?></th>
                  <th width="75"><?php echo $this->translate("#Requirement For Receiving") ?></th>
                </tr>
              </thead>
              <tbody>
                <!-- ### loop de carga das ações que são produto -->
<?php
foreach($productsList as $id => $productInfo) {
?>
                <tr>
                  <td>
                    <a href="/projects/action/detail/?id=<?php print($id) ?>"><?php print($productInfo['productTitle']) ?></a>
                  </td>
                  <td class="Right">
                    <?php print($productInfo['predictedDate']) ?>
                  </td>
                  <td class="Right">
                    <?php  print($productInfo['realDate']) ?>
                  </td>
                  <td>
                    <?php print($productInfo['status']) ?>
                  </td>
                  <td>
                    <?php print($productInfo['physicalProgress']) ?>
                  </td>
                  <td>
<?php
    if ((isset($productInfo['receivableId'])) && ($productInfo['receivableId'] > 0)) {
?>
                      <div class="receivable">
                          <a title="<?php print($productInfo['receivableDescription']) ?>" href="/projects/receivable/detail/?id=<?php  print($productInfo['receivableId'])  ?>"><?php  print($productInfo['requirementForReceiving'])  ?></a>
                          <!--<em>Essa é a descrição de um recebimento conforme consta no contrato.<br>Inclusive com mais de uma linha.<br></em>-->
                      </div
<?php
    } else {
              print($productInfo['requirementForReceiving']);
    }
?>

                  </td>
                </tr>
<?php
}
?>
              </tbody>
            </table><br />

          </div><!-- Area -->
    <div class="Area">

      <p>
        <a href="/projects/receivable/create/?project=<?php echo $projectHeader['id'] ?>" class="button three columns alpha omega"><?php echo $this->translate("#Predict receiving") ?></a>
      </p>

    </div><!-- .Area -->

        </div><!-- tabs-products -->

        <div id="tabs-payments">
          <div class="Area">
            <h2><?php echo $this->translate("#Payments") ?></h2>

<!-- ### INSERÇÃO DO CÓDIGO DE PAYABLES.PHTML COM ALTERAÇÕES DE RPORTO -->

<?php
/*
 * if there is payables in list
 */
      if (count($outlaysList)) {
?>
           <table id="Pagamentos" class="display dataTable">
              <thead>
                <tr>
                  <th width="300"><?php echo $this->translate("#Action") ?></th>
                  <th width="300"><?php echo $this->translate("#Payee") ?></th>
                  <th width="50"><?php echo $this->translate("#Predicted date") ?></th>
                  <th width="50"><?php echo $this->translate("#Real date") ?></th>
                  <th width="50"><?php echo $this->translate("#Predicted value") ?></th>
                  <th width="50"><?php echo $this->translate("#Real value") ?></th>
                  <th width="1%">&nbsp;</th>
                </tr>
              </thead>
              <tbody>
<?php
foreach($outlaysList as $id => $outlayInfo) {
?>
                <!-- ### loop de carga das ações que geram pagamentos -->
                <tr>
                  <td>
                    <a href="/projects/action/detail/?id=<?php print($outlayInfo['actionId']) ?>"><?php print($outlayInfo['actionTitle']) ?></a>
                  </td>
                  <td>
<?php
if($outlayInfo['payeeId'] > 0) {
?>
                    <a href="/register/contact/detail/?id=<?php  print $outlayInfo['payeeId'] ?>"><?php print($outlayInfo['payeeName']) ?></a>
<?php

} else {
?>
<?php print($outlayInfo['payeeName']) ?>
<?php

}
?>
                  </td>
                  <td>
                    <?php print($outlayInfo['predictedDate']) ?>
                  </td>
                  <td>
                    <?php print($outlayInfo['realDate']) ?>
                  </td>
                  <td class="Right">
                    <?php print($outlayInfo['predictedValue']) ?>
                  </td>
                  <td class="Right">
                    <?php print($outlayInfo['realValue']) ?>
                  </td>
                  <td>
                    <a href="#" class="anchorclass" rel="submenu1"><?php echo $this->translate("#Options") ?></a>
                    <div id="submenu1" class="anylinkcss">
                        <ul>
                          <li>
                            <!-- [# LINK PARA A EDIÇÃO DO PAGAMENTO ] -->
                            <a href="/projects/outlay/edit/?id=<?php print($id) ?>"><?php echo $this->translate("#Edit") ?></a>
                          </li>
                          <li>
                            <!-- [# LINK PARA FORM DE CONFIRMAÇÃO DE PAGAMENTO -> VAI ABRIR EM BOX DE DIÁLOGO MODAL ] -->
                            <a href="/projects/outlay/confirm/?id=<?php print($id) ?>"><?php echo $this->translate("#Confirm payment") ?></a>
                          </li>
                          <li>
                            <!-- [# LINK PARA PÁGINA DE DETALHAMENTO DO PAGAMENTO ] -->
                            <a href="/projects/outlay/detail/?id=<?php print($id) ?>"><?php echo $this->translate("#Outlay details") ?></a>
                          </li>
                        </ul>
                    </div><!-- #submenu1 -->
                  </td>
                </tr>
<?php
}
?>
                <!-- ### fim do loop de carga das ações que são produto -->

              </tbody>
            </table><br />

            <p>
              <!-- [# LINK PARA PÁGINA DE CRIAÇÃO DE PAGAMENTO ]  -->
              <a href="#" class="button three columns alpha omega"><?php echo $this->translate("#Predict outlay") ?></a>
            </p>

<?php
      } else { // end else there is payables in list
?>
            <p><?php print($this->translate("#There is no outlays related to this project.")) ?></p>

<?php
      } // end else there is payables in list
?>
<!-- ### FIM DA INSERÇÃO DO CÓDIGO DE PAYABLES.PHTML -->

          </div><!-- Area -->
        </div><!-- tabs-payments -->

<!-- ### ACHO QUE O CONTEÚDO DESTA ABA É NOVO - NÃO ENCONTREI EM NENHUM PHTM -->
        <div id="tabs-staff">
          <div class="Area">
            <h2><?php print($this->translate('#Team')) ?></h2>
            <table id="Equipe" class="display dataTable">
              <thead>
                <tr>
                  <th width="220"><?php echo $this->translate("#Name") ?></th>
                  <th width="80"><?php echo $this->translate("#Function") ?></th>
                  <th width="100"><?php echo $this->translate("#Email") ?></th>
                  <th width="100"><?php echo $this->translate("#Phone number") ?></th>
                  <th width="100">&nbsp;</th>
                </tr>
              </thead>
              <tbody>
              <!-- ### loop de carga dos recursos humanos alocados ao projeto -->
<?php

foreach($teamData as $id => $staffInfo) {
?>
                <tr>
                  <td>
<?php
if($staffInfo['contactId'] > 0) {
?>
                    <a href="/register/contact/detail/?id=<?php  print $staffInfo['contactId'] ?>"><?php print($staffInfo['staffName']) ?></a>
<?php

} else {
?>
<?php print($staffInfo['staffName']) ?>
<?php

}
?>
                  </td>
                  <td>
                    <a href="/projects/action/detail/?id=<?php print($staffInfo['actionId']) ?>"><?php print($staffInfo['positionDescription']) ?></a>
                  </td>
                  <td>
                    <a href="mailto:<?php print($staffInfo['staffEmail']) ?>"><?php print($staffInfo['staffEmail']) ?></a>
                  </td>
                  <td>
                    <?php print($staffInfo['staffPhoneNumber']) ?>
                  </td>
                  <td>
                    <a href="#" class="anchorclass" rel="submenu1"><?php echo $this->translate("#Options") ?></a>
                    <div id="submenu1" class="anylinkcss">
                        <ul>
                          <li>
                            <!-- [# LINK PARA A EDIÇÃO DO CONTATO ] -->
                            <a href="/projects/team-member/edit/?id=<?php print($id) ?>"><?php echo $this->translate("#Edit") ?></a>
                          </li>
                        </ul>
                    </div><!-- #submenu1 -->
                  </td>
                </tr>
<?php
}
?>
              <!-- ### loop de carga dos recursos humanos alocados ao projeto -->
              </tbody>
            </table><br />
          </div><!-- Area -->
        </div><!-- tabs-staff -->
        <div id="tabs-action">
          <div class="Area">
            <h2><?php echo $this->translate("#Actions") ?></h2>
    <table id="tree" border="1">
    	<thead>
    		<tr>
    			<th width="200" align="left"><?php echo $this->translate("#Action") ?></th>
    			<th width="200" align="left"><?php echo $this->translate("#Responsible") ?></th>
    			<th width="100" align="left"><?php echo $this->translate("#Pred. begin date") ?></th>
    			<th width="100" align="left"><?php echo $this->translate("#Real begin date") ?></th>
    			<th width="100" align="left"><?php echo $this->translate("#Pred. finish date") ?></th>
    			<th width="100" align="left"><?php echo $this->translate("#Real finish date") ?></th>
    		</tr>
    	</thead>
    	<tbody>
<?php
foreach ($actionsList as $id => $actionData) {
    $nodeId = "node-" . $id;
    $childOf = $actionData['subordinatedTo'];
    if ($childOf > 0) {
        $classId = "\"child-of-node-$childOf\"";
        $classId = 'class = ' . $classId;
    }

?>
        <tr id="<?php print ($nodeId) ?>" <?php print (($childOf > 0 ? $classId : '')) ?>>
          <td><a href='/projects/action/detail/?id=<?php print($id) ?>'><?php print ($actionData['title']) ?></a></td>
          <td><?php print ($actionData['responsibleName']) ?></td>
          <td><?php print ($actionData['predictedBeginDate']) ?></td>
          <td><?php print ($actionData['realBeginDate']) ?></td>
          <td><?php print ($actionData['predictedFinishDate']) ?></td>
          <td><?php print ($actionData['realFinishDate']) ?></td>
        </tr>
<?php
}
?>
        <!-- # Fim do loop -->
      </tbody>
    </table>
<br />
          </div><!-- Area -->
    <div class="Area">
      <p>
        <a href="/projects/project/payables/?id=<?php print($projectHeader['id']) ?>" class="button three columns alpha omega">Consultar ações realizadas</a>
        <a href="/projects/action/create/?project=<?php print($projectHeader['id']) ?>" class="button three columns "><?php echo $this->translate("#Create new action") ?></a>
        <a href="/projects/project/unacknowledged/?id=<?php print($projectHeader['id']) ?>" class="button three columns alpha omega">Ações com início a confirmar</a>
      </p>
    </div><!-- .Area -->

        </div><!-- tabs-action -->
        <div id="tabs-details">
          <div class="Area">
            <h2><?php echo $this->translate("#Details") ?></h2>
          </div><!-- Area -->
    <div class="Area">

<?php
if ($detailsData['object'] != "") {
?>
      <p>
<?php echo $this->translate("#Object") ?>
      </p>
      <p>
<?php print ($detailsData['object']) ?>
      </p>

<?php
}
?>

<?php
if ($detailsData['summary'] != "") {
?>
      <p>
<?php echo $this->translate("#Summary") ?>
      </p>
      <p>
<?php print ($detailsData['summary']) ?>
      </p>

<?php
}
?>

<?php
if ($detailsData['observation'] != "") {
?>
      <p>
<?php echo $this->translate("#Observation") ?>
      </p>
      <p>
<?php print ($detailsData['observation']) ?>
      </p>
<?php
}
?>

    </div><!-- .Area -->

        </div><!-- tabs-details -->
      </div><!-- #tabs --><!-- testing second commit -->

